<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="P[i]-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>

<body>
    <script>
        var longestPalindrome = function (s) {
            let P = []
            let longest = 0
            let resI = 0
            let s0 = ''
            for (let x = 0; x < s.length; x++) {
                if (x === 0) {
                    s0 = '#' + s[x] + '#'
                    continue
                }
                s0 = s0 + s[x] + '#'
            }
            let len = s0.length

            let C = R = 0
            P[0] = 0

            for (let i = 1; i < len; i++) {
                let iMirror = 2 * C - i
                if (!P[iMirror]) {
                    P[iMirror] = 0
                }

                if (P[iMirror] < R - i) {
                    P[i] = P[iMirror]
                    continue
                } else {
                    P[i] = R - i
                }
                if (P[i] < 0) {
                    P[i] = 0
                }

                while (i - P[i] > 0 && i + P[i] < len - 1) {
                    if (s0[i - P[i] - 1] === s0[i + P[i] + 1]) {
                        P[i]++
                        if (P[i] > longest) {
                            resI = Math.floor((i - P[i]) / 2)
                            longest = P[i]
                        }
                    } else {
                        break
                    }
                }

                if (i + P[i] > R) {
                    C = i
                    R = C + P[i]
                }
            }
            return s.substr(resI, longest)
        };
        console.log(longestPalindrome('ab'))
    </script>
</body>

</html>

<!-- #a#b# -->